<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Web Worker ç®€å•ç¤ºä¾‹</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				max-width: 800px;
				margin: 50px auto;
				padding: 20px;
				background: #f5f5f5;
			}

			.container {
				background: white;
				padding: 30px;
				border-radius: 8px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			}

			h1 {
				color: #333;
				border-bottom: 3px solid #4caf50;
				padding-bottom: 10px;
			}

			button {
				background: #4caf50;
				color: white;
				border: none;
				padding: 12px 24px;
				border-radius: 4px;
				cursor: pointer;
				font-size: 16px;
				margin: 10px 5px;
			}

			button:hover {
				background: #45a049;
			}

			.result {
				margin-top: 20px;
				padding: 15px;
				background: #f9f9f9;
				border-left: 4px solid #4caf50;
				border-radius: 4px;
			}

			.loading {
				border-left-color: #2196f3;
			}

			.error {
				border-left-color: #f44336;
			}

			pre {
				background: #272822;
				color: #f8f8f2;
				padding: 15px;
				border-radius: 4px;
				overflow-x: auto;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>ğŸš€ Web Worker ç®€å•ç¤ºä¾‹</h1>

			<div style="margin: 20px 0">
				<h3>æµ‹è¯•è®¡ç®—ï¼ˆè§‚å¯Ÿé¡µé¢æ˜¯å¦å¡é¡¿ï¼‰</h3>
				<button onclick="testWithoutWorker()">ä¸ä½¿ç”¨ Workerï¼ˆä¼šå¡é¡¿ï¼‰</button>
				<button onclick="testWithWorker()">ä½¿ç”¨ Workerï¼ˆä¸å¡é¡¿ï¼‰</button>
				<button onclick="testAnimation()">æµ‹è¯•åŠ¨ç”»</button>

				<div
					id="animation"
					style="
						width: 50px;
						height: 50px;
						background: #4caf50;
						margin: 20px 0;
						transition: transform 0.3s;
					"
				></div>
				<div id="result"></div>
			</div>

			<div
				style="
					margin: 30px 0;
					padding: 20px;
					background: #fff3cd;
					border-radius: 4px;
				"
			>
				<h4>ğŸ“ ä½¿ç”¨è¯´æ˜ï¼š</h4>
				<ol>
					<li>æ­¤ç¤ºä¾‹ä½¿ç”¨ç‹¬ç«‹çš„ <code>worker.js</code> æ–‡ä»¶</li>
					<li>éœ€è¦é€šè¿‡ HTTP æœåŠ¡å™¨è¿è¡Œï¼ˆå¦‚ Live Serverï¼‰</li>
					<li>ä¸èƒ½ç›´æ¥åŒå‡»æ‰“å¼€ï¼ˆä¼šæœ‰ CORS é”™è¯¯ï¼‰</li>
					<li>ç‚¹å‡»"æµ‹è¯•åŠ¨ç”»"æŒ‰é’®ï¼Œç„¶åç‚¹å‡»è®¡ç®—æŒ‰é’®ï¼Œè§‚å¯ŸåŠ¨ç”»æ˜¯å¦æµç•…</li>
				</ol>
			</div>

			<div>
				<h3>ğŸ’» ä»£ç ç¤ºä¾‹ï¼š</h3>
				<pre>
// ä¸»çº¿ç¨‹ä»£ç 
const worker = new Worker('worker.js');

// å‘é€æ¶ˆæ¯ç»™ Worker
worker.postMessage({
    type: 'calculate',
    data: { max: 1000000000 }
});

// æ¥æ”¶ Worker çš„æ¶ˆæ¯
worker.onmessage = function(e) {
    console.log('ç»“æœ:', e.data.result);
    worker.terminate(); // ç»ˆæ­¢ Worker
};</pre
				>

				<pre>
// worker.js æ–‡ä»¶
self.onmessage = function(e) {
    const { type, data } = e.data;
    
    if (type === 'calculate') {
        let sum = 0;
        for (let i = 1; i <= data.max; i++) {
            sum += i;
        }
        self.postMessage({ result: sum });
    }
};</pre
				>
			</div>
		</div>

		<script>
			const resultDiv = document.getElementById("result");

			// ä¸ä½¿ç”¨ Workerï¼ˆä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼‰
			function testWithoutWorker() {
				resultDiv.className = "result loading";
				resultDiv.innerHTML =
					"<strong>â³ è®¡ç®—ä¸­...</strong><br>é¡µé¢ä¼šå¡é¡¿ï¼Œæ— æ³•æ“ä½œï¼";

				setTimeout(() => {
					const startTime = performance.now();

					let sum = 0;
					for (let i = 1; i <= 1000000000; i++) {
						sum += i;
					}

					const endTime = performance.now();

					resultDiv.className = "result error";
					resultDiv.innerHTML = `
                    <strong>âŒ ä¸»çº¿ç¨‹è®¡ç®—å®Œæˆ</strong><br>
                    ç»“æœ: ${sum}<br>
                    è€—æ—¶: ${(endTime - startTime).toFixed(2)}ms<br>
                    <span style="color: red;">è¿™æœŸé—´é¡µé¢å®Œå…¨å¡æ­»ï¼</span>
                `;
				}, 100);
			}

			// ä½¿ç”¨ Workerï¼ˆä¸é˜»å¡ä¸»çº¿ç¨‹ï¼‰
			function testWithWorker() {
				resultDiv.className = "result loading";
				resultDiv.innerHTML =
					"<strong>â³ Worker è®¡ç®—ä¸­...</strong><br>é¡µé¢ä¿æŒæµç•…ï¼";

				// æ£€æŸ¥ worker.js æ˜¯å¦å­˜åœ¨
				const worker = new Worker("worker.js");
				const startTime = performance.now();

				worker.postMessage({
					type: "calculate",
					data: { max: 1000000000 },
				});

				worker.onmessage = function (e) {
					const endTime = performance.now();

					resultDiv.className = "result";
					resultDiv.innerHTML = `
                    <strong>âœ… Worker è®¡ç®—å®Œæˆ</strong><br>
                    ç»“æœ: ${e.data.result}<br>
                    è€—æ—¶: ${(endTime - startTime).toFixed(2)}ms<br>
                    <span style="color: green;">é¡µé¢æ²¡æœ‰ä»»ä½•å¡é¡¿ï¼</span>
                `;

					worker.terminate();
				};

				worker.onerror = function (error) {
					resultDiv.className = "result error";
					resultDiv.innerHTML = `
                    <strong>âŒ é”™è¯¯</strong><br>
                    ${error.message}<br>
                    <br>
                    <strong>å¯èƒ½çš„åŸå› ï¼š</strong><br>
                    1. æ²¡æœ‰æ‰¾åˆ° worker.js æ–‡ä»¶<br>
                    2. æ²¡æœ‰ä½¿ç”¨ HTTP æœåŠ¡å™¨è¿è¡Œï¼ˆç›´æ¥æ‰“å¼€æ–‡ä»¶ä¼šæœ‰ CORS é”™è¯¯ï¼‰<br>
                    <br>
                    <strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>
                    ä½¿ç”¨ Live Server æˆ–å…¶ä»– HTTP æœåŠ¡å™¨è¿è¡Œæ­¤æ–‡ä»¶
                `;
				};
			}

			// æµ‹è¯•åŠ¨ç”»
			function testAnimation() {
				const animation = document.getElementById("animation");
				if (animation.style.transform === "translateX(200px)") {
					animation.style.transform = "translateX(0)";
				} else {
					animation.style.transform = "translateX(200px)";
				}
			}

			// é¡µé¢åŠ è½½æç¤º
			console.log("âœ… é¡µé¢åŠ è½½å®Œæˆ");
			console.log("ğŸ’¡ ç‚¹å‡»æŒ‰é’®æµ‹è¯• Web Worker");
		</script>
	</body>
</html>
