# 前端安全问题

## 一、CSRF 攻击

### 什么是 CSRF 攻击

**CSRF**（Cross-Site Request Forgery，跨站请求伪造）是一种挟制用户在当前已登录的 Web 应用程序上执行非本意操作的攻击方法。

#### 攻击原理

假如黑客在自己的站点上放置了其他网站的外链，例如 `www.weibo.com/api`，默认情况下，浏览器会带着 `weibo.com` 的 Cookie 访问这个网址。如果用户已登录过该网站且网站没有对 CSRF 攻击进行防御，那么服务器就会认为是用户本人在调用此接口并执行相关操作，致使账号被劫持。这种攻击更常见于银行网站的转账请求等敏感操作。

### 如何防御 CSRF 攻击

#### 1. 验证 Token

浏览器请求服务器时，服务器返回一个 Token，每个请求都需要同时带上 Token 和 Cookie 才会被认为是合法请求。

#### 2. 验证 Referer

通过验证请求头的 Referer 来验证来源站点，但请求头容易被伪造，安全性相对较低。

#### 3. 设置 SameSite Cookie 属性

SameSite 是 Cookie 的一个属性，用来防止 CSRF 攻击。如果一个 Cookie 的 SameSite 属性被设置为 Strict，那么这个 Cookie 只会在同一个站点中被发送，这就防止了攻击者在其他站点中伪造请求。

**SameSite 的三个选项值：**

- **Strict**：最严格，浏览器完全禁止第三方站点携带 Cookie
- **Lax**：相对宽松，在跨站点的情况下，从第三方站点的链接打开或 GET 方式的表单提交这两种方式都会携带 Cookie；除此之外，如 POST 请求、img、iframe 等加载的 URL，都不会携带 Cookie
- **None**：最宽松，在任何情况下都会发送 Cookie 数据（需要同时设置 Secure 属性）

---

## 二、XSS 攻击

### 什么是 XSS 攻击

**XSS**（Cross Site Scripting，跨站脚本）指的是通过利用网页开发时留下的漏洞，注入恶意指令代码到网页，使用户加载并执行攻击者恶意制造的网页程序。

常见的例如在评论区植入 JS 代码，用户进入评论页时代码被执行，造成页面被植入广告、账号信息被窃取等危害。

### XSS 攻击的类型

#### 1. 存储型 XSS（Stored XSS）

攻击被存储在服务端，常见的是在评论区插入攻击脚本。如果脚本被储存到服务端，那么所有看见对应评论的用户都会受到攻击。危害范围最广，影响最大。

#### 2. 反射型 XSS（Reflected XSS）

攻击者将脚本混在 URL 里，服务端接收到 URL 将恶意代码当做参数取出并拼接在 HTML 里返回，浏览器解析此 HTML 后即执行恶意代码。通常需要诱导用户点击恶意链接。

#### 3. DOM 型 XSS（DOM-based XSS）

将攻击脚本写在 URL 中，诱导用户点击该 URL，如果 URL 被解析，那么攻击脚本就会被运行。和前两者的差别主要在于 DOM 型攻击不经过服务端，完全在客户端触发。

### 如何防御 XSS 攻击

#### 1. 输入检查与输出转义

- 对输入内容中的 `<script>`、`<iframe>` 等危险标签进行转义或者过滤
- 对特殊字符（如 `<`、`>`、`&`、`"`、`'` 等）进行 HTML 实体编码

#### 2. 设置 HttpOnly 属性

很多 XSS 攻击目标都是窃取用户 Cookie 伪造身份认证，设置 HttpOnly 属性可防止 JavaScript 获取 Cookie，降低信息泄露风险。

#### 3. 开启 CSP（Content Security Policy）

即内容安全策略，通过设置白名单，可阻止白名单以外的资源加载和运行，有效防止 XSS 攻击。

---

## 总结

前端安全是 Web 开发中不可忽视的重要环节，CSRF 和 XSS 是两种最常见的攻击方式。在实际开发中，应该采取多层防御策略，结合服务端和客户端的安全措施，才能更好地保护用户数据和隐私安全。
